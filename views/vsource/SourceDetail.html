{% import "github.com/kyleu/admini/app" %}
{% import "github.com/kyleu/admini/app/controller/cutil" %}
{% import "github.com/kyleu/admini/app/schema" %}
{% import "github.com/kyleu/admini/app/source" %}
{% import "github.com/kyleu/admini/views/components/fieldview" %}
{% import "github.com/kyleu/admini/views/layout" %}
{% import "github.com/kyleu/admini/views/vmodel" %}

{% code type SourceDetail struct {
  layout.Basic
  Source *source.Source
  Schema *schema.Schema
} %}

{% func (p *SourceDetail) Body(as *app.State, ps *cutil.PageState) %}
  <div class="card">
    <h3>{%s p.Source.Title %}</h3>
    <p>
      <a href="{%s as.Route(`source.refresh`, `key`, p.Source.Key) %}">Refresh</a>
      <a href="{%s as.Route(`workspace`, `key`, p.Source.Key) %}">Workspace</a>
    </p>
    {%= fieldview.JSON(p.Source) %}
  </div>
  <div class="card">
    <h3>Models</h3>
    <ul class="accordion">
    {% if p.Schema != nil %}{% for idx, model := range p.Schema.Models %}
      {%= vmodel.ModelDetail(p.Source.Key, idx, model, as, ps) %}
    {% endfor %}{% endif %}
    </ul>
  </div>
  <div class="card">
    <h3>Schema</h3>
    {%= fieldview.JSON(p.Schema) %}
  </div>
{% endfunc %}
