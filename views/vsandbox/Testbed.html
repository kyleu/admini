{% import "sort" %}
{% import "github.com/kyleu/admini/app" %}
{% import "github.com/kyleu/admini/app/controller/cutil" %}
{% import "github.com/kyleu/admini/app/result" %}
{% import "github.com/kyleu/admini/app/schema" %}
{% import "github.com/kyleu/admini/app/util" %}
{% import "github.com/kyleu/admini/views/components" %}
{% import "github.com/kyleu/admini/views/layout" %}
{% import "github.com/kyleu/admini/views/vresult" %}
{% import "github.com/kyleu/admini/queries" %}

{% code type Testbed struct { layout.Basic } %}

{% func (p *Testbed) Body(as *app.State, ps *cutil.PageState) %}
{%= icons(as, ps) %}
{%= tabs(as, ps) %}
{%= accordion(as, ps) %}
{%= modal(as, ps) %}
{%- code data := ps.Data.(map[string]interface{}) -%}
{% if len(data) > 0 %}{%= db(as, ps) %}{% endif %}
{% endfunc %}

{%- func icons(as *app.State, ps *cutil.PageState) -%}
  <div class="card">
    <h3>Icons!</h3>
    <div style="display: flex;">
      {%- code
      keys := make([]string, 0, len(util.SVGLibrary))
      for k, _ := range util.SVGLibrary {
      keys = append(keys, k)
      }
      sort.Strings(keys)
      -%}
      {%- for _, k := range keys -%}
      <div style="text-align: center; margin: 6px 12px 6px 0; padding: 6px; border: var(--border)">
        <div style="width: 64px; height: 64px;">{%s= util.SVGLibrary[k] %}</div>
        {%s k %}
      </div>
      {%- endfor -%}
    </div>
  </div>
{%- endfunc -%}

{%- func tabs(as *app.State, ps *cutil.PageState) -%}
  <div class="card">
    <h3>Tabs</h3>
    <div class="tabs">
      {%- for _, o := range schema.AllOrigins -%}
      <input name="type" type="radio" id="sandbox-{%s o.Key %}" class="input"/>
      <label for="sandbox-{%s o.Key %}" class="label">{%s o.Title %}</label>
      <div class="panel"><p>{%s o.Description %}</p></div>
      {%- endfor -%}
    </div>
  </div>
{%- endfunc -%}

{%- func accordion(as *app.State, ps *cutil.PageState) -%}
  <div class="card">
    <h3>Accordion</h3>
    <ul class="accordion">
      <li>
        <input id="accordion-a" type="checkbox" hidden />
        <label for="accordion-a">{%= components.ExpandCollapse(3, ps) %} Option A</label>
        <div class="bd">Option A!</div>
      </li>
      <li>
        <input id="accordion-b" type="checkbox" hidden />
        <label for="accordion-b">{%= components.ExpandCollapse(3, ps) %} Option B</label>
        <div class="bd">Option B!</div>
      </li>
      <li>
        <input id="accordion-c" type="checkbox" hidden />
        <label for="accordion-c">{%= components.ExpandCollapse(3, ps) %} Option C</label>
        <div class="bd">Option C!</div>
      </li>
    </ul>
  </div>
{%- endfunc -%}

{%- func modal(as *app.State, ps *cutil.PageState) -%}
  <div class="card">
    <h3>Modal</h3>
    <div><a href="#modal-x">Open modal</a></div>
  </div>
  <div id="modal-x" class="modal" style="display: none;">
    <a class="backdrop" href="#"></a>
    <div class="modal-content">
      <div class="modal-header">
        <a href="#" class="modal-close">Ã—</a>
        <h2>Modal</h2>
      </div>
      <div class="modal-body">
        Here's a modal body!
      </div>
    </div>
  </div>
{%- endfunc -%}

{%- func db(as *app.State, ps *cutil.PageState) -%}
  {%- code data := ps.Data.(map[string]interface{}) -%}
  <div class="card">
    <h3>Types</h3>
    <pre>{%s queries.ListTypes("") %}</pre>
    {%= vresult.View("", "", data["types"].(*result.Result), nil, 3, nil, as, ps) %}
  </div>
  <div class="card">
    <h3>Tables</h3>
    <pre>{%s queries.ListTables("") %}</pre>
    {%= vresult.View("", "", data["tables"].(*result.Result), nil, 3, nil, as, ps) %}
  </div>
  <div class="card">
    <h3>Columns</h3>
    <pre>{%s queries.ListColumns("") %}</pre>
    {%= vresult.View("", "", data["columns"].(*result.Result), nil, 3, nil, as, ps) %}
  </div>
  <div class="card">
    <h3>Indexes</h3>
    <pre>{%s queries.ListIndexes("") %}</pre>
    {%= vresult.View("", "", data["indexes"].(*result.Result), nil, 3, nil, as, ps) %}
  </div>
  <div class="card">
    <h3>Foreign Keys</h3>
    <pre>{%s queries.ListForeignKeys("") %}</pre>
    {%= vresult.View("", "", data["fks"].(*result.Result), nil, 3, nil, as, ps) %}
  </div>
{%- endfunc -%}
